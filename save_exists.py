import os
import re
import numpy as np

# 原始数据字符串
raw_data = """
betas:
[-2.8851, -2.4817,  0.2084, -0.9704, -3.1418,  1.8980,  0.9681,  0.5664, 4.0000,  0.6063]
[ 0.4906,  2.9412,  1.3031,  0.3389,  2.6026, -1.4581, -2.0243, -1.8369, -0.4345,  1.8152]
[ 1.0589e+00, -4.6721e-01,  2.0244e+00,  4.0751e-01, -4.0000e+00, -1.0413e+00, -1.9264e+00,  1.9504e-04, -2.0112e+00,  2.2717e+00]
[ 0.7241,  2.0241,  2.2112,  2.7469,  0.1647, -2.9382, -3.3602, -0.2132, 1.4561, -1.3186]
[ 1.0383,  0.9897, -1.0426, -3.1447, -2.7385,  1.2902,  0.9635,  0.6773, -1.8543,  2.8285]
[ 1.3583, -1.3687, -2.1332, -3.8337,  1.1151,  2.0531,  0.0888,  2.1581, 1.2370, -0.1138]
[ 0.6114,  2.3763, -1.8436, -2.9855, -0.8166,  0.4911,  0.3808,  0.3249, -1.8360, -2.8035]


pose:
[ 7.6273e-03,  2.5063e+00, -1.9511e-01, -1.7639e-01, -1.2349e-01,
8.2437e-02, -8.6895e-01, -1.2313e-01, -1.4138e-01,  1.0146e-02,
1.6177e-02, -1.6454e-02,  5.8136e-02,  1.9996e-08,  7.2368e-09,
8.2869e-01,  1.5658e-08,  1.2129e-08, -6.0128e-03,  1.4322e-02,
-4.0169e-04,  5.1373e-03, -7.6693e-03,  4.3201e-03, -9.2288e-04,
-1.3720e-02,  3.0982e-03,  9.7561e-03,  6.8682e-03, -3.0262e-03,
-8.1478e-10,  1.6628e-08,  4.7125e-09,  2.6972e-09, -2.1026e-09,
-5.6922e-09, -9.2682e-04, -2.6598e-03,  1.6578e-03,  1.3667e-01,
2.0450e-01, -3.7095e-01, -2.4308e-02,  6.5527e-02, -2.7415e-01,
-1.1369e-03,  2.0449e-03, -2.3649e-03,  1.9557e-01,  4.0631e-02,
-7.6002e-01, -6.9793e-02,  1.6193e-02, -3.9004e-01,  1.7004e-08,
-4.3488e-01,  1.1903e-08, -8.8573e-09,  1.7065e+00, -4.1249e-09,
5.9274e-03,  1.0679e-01,  2.1180e-02, -2.6585e-02,  1.8467e-01,
-4.0776e-03, -6.2428e-09,  1.0427e-08,  1.6432e-08,  7.3340e-09,
-1.8004e-09,  9.8214e-09]

[ 4.2562e-03,  2.8311e-01,  2.0434e-01, -6.2224e-01,  2.9277e-01,
-7.4646e-03, -6.9485e-01,  1.4996e-01,  4.5666e-02, -4.6294e-03,
-5.5492e-03, -2.2337e-02,  1.1978e+00, -9.7919e-09,  2.6928e-08,
1.7100e+00, -1.3331e-09,  1.5025e-08,  7.5511e-04,  6.9074e-02,
1.0072e-02,  1.9892e-02,  6.1661e-03, -4.9728e-03,  1.4285e-02,
4.7782e-03,  2.7555e-03,  1.4546e-04,  2.8708e-02, -5.6264e-02,
-6.5730e-09,  1.7761e-09, -1.3116e-08,  1.2530e-08,  7.4356e-09,
1.2790e-08, -2.2314e-03,  7.2749e-03, -1.4723e-02, -4.7950e-01,
2.4295e-01,  3.1724e-01,  4.4506e-02,  4.2337e-01,  2.4460e-01,
2.3781e-02, -2.9903e-02,  8.5036e-02, -5.0409e-01, -6.0388e-01,
-2.9162e-01,  2.1846e-01,  7.3990e-01,  5.4115e-01,  8.5951e-09,
-1.4840e+00, -7.2090e-09, -3.5573e-09,  1.0862e+00,  1.2154e-08,
-2.3177e-02, -5.3986e-02, -1.8060e-02,  1.0571e-01, -3.5564e-03,
2.7607e-02,  2.7674e-08,  1.1990e-08, -5.6254e-09, -3.1344e-09,
-8.0360e-09,  2.9509e-10]

[-2.7805e-02,  9.4307e-02,  3.6526e-01,  1.5046e-02,  1.7601e-01,
-2.1146e-01, -9.9455e-02, -2.8599e-01, -2.7821e-01, -3.6206e-02,
-1.0216e-02, -8.5061e-02,  1.5210e-01, -1.9505e-08, -2.5424e-09,
3.2030e-01, -8.4037e-09, -4.2090e-09,  6.5735e-02, -3.7191e-02,
4.2605e-02,  9.3296e-02, -6.6474e-02, -9.8941e-02,  1.0354e-01,
5.2907e-01, -9.6246e-03, -1.3110e-02, -2.6621e-02,  7.9892e-03,
1.6229e-09,  1.0333e-08, -2.4434e-08,  9.3310e-10,  1.1394e-08,
-5.3255e-09, -3.2575e-04,  8.5893e-03, -7.2332e-03,  1.0448e-01,
-5.6226e-02, -3.3154e-01, -1.7436e-01, -2.6155e-01,  3.7101e-01,
3.2393e-03, -2.3110e-03,  7.1537e-04, -3.0722e-02,  3.7841e-01,
-6.1147e-01, -6.1376e-01, -3.3579e-01,  5.2893e-01,  6.9583e-09,
-6.8467e-01,  1.9462e-11, -7.1557e-09,  2.2263e-01,  3.5235e-09,
1.3719e-02,  1.2038e-02,  5.9836e-03,  4.7760e-03, -1.4627e-02,
-1.3564e-02,  1.1339e-08,  7.3953e-09, -1.1089e-08, -3.0863e-09,
2.8039e-09,  8.0929e-09]

[-1.7521e-02, -1.9580e+00,  5.5765e-02, -1.0657e+00, -2.6613e-01,
2.5793e-02, -5.5516e-01,  1.4003e-01,  5.0501e-02,  1.6178e-03,
-2.9725e-02, -3.0168e-02,  3.8214e-01,  1.1134e-08,  9.7686e-09,
1.6561e+00,  2.2527e-08,  1.9185e-08, -4.0478e-02,  3.0830e-02,
1.5804e-02,  3.0214e-02, -4.8878e-01, -1.4692e-01, -7.7287e-02,
-2.2759e-01, -4.4943e-01,  5.3577e-02, -2.3991e-03, -3.5543e-02,
-1.9019e-09, -1.3367e-08, -1.0346e-08, -2.6879e-08, -4.8565e-09,
-8.4939e-09, -1.0757e-02, -3.9194e-02,  5.7115e-02,  7.9584e-03,
-3.8770e-01, -5.7020e-01, -5.4278e-01, -2.6930e-01, -4.4301e-01,
-1.3819e-02,  2.1495e-02, -3.0782e-02,  3.2954e-01, -2.5740e-01,
-9.5273e-01, -7.6007e-01,  8.5475e-01, -6.9224e-01,  6.0646e-09,
-2.2454e-01,  1.6740e-09, -2.1220e-09,  6.5742e-01, -5.6634e-09,
-1.0345e-01,  6.6013e-02,  8.4216e-03,  1.5815e-01,  1.4483e-01,
1.1459e-01, -3.1285e-09, -7.7307e-09, -9.7199e-09, -1.0007e-08,
-6.9515e-09, -3.5020e-09]

[-8.0232e-02,  4.2053e+00, -1.5857e-01, -1.0874e+00, -4.9454e-02,
1.6692e-01, -4.3563e-01, -3.2929e-01,  5.8219e-02,  4.1682e-02,
-2.4586e-02,  4.8563e-02,  4.9363e-01,  1.3581e-08,  3.0739e-09,
1.2831e-01,  1.5183e-08, -9.4886e-09,  5.4440e-02,  1.3097e-02,
-2.3843e-02, -1.9046e-02,  2.9298e-02,  1.1388e-02,  8.6149e-02,
4.1020e-01, -1.7550e-01, -1.0815e-01, -8.5183e-02, -8.3762e-03,
1.6990e-08,  3.4548e-09, -2.0164e-09, -7.8300e-09,  5.0875e-09,
1.2571e-08,  6.3477e-02,  2.3308e-02,  5.5436e-02, -7.9429e-02,
-4.0659e-01,  4.9085e-01, -5.1194e-01,  5.8520e-02, -4.8715e-01,
-4.1993e-03,  1.9857e-02, -4.6770e-02, -2.5717e-01, -5.9861e-01,
3.6114e-01,  5.1171e-01,  1.6691e+00,  3.0224e-01, -1.1517e-08,
-7.9674e-01,  1.9983e-09, -1.3910e-08,  6.5120e-01,  1.6094e-08,
-4.4080e-01, -1.8902e-03,  1.4699e-01,  3.5344e-01,  2.0278e-01,
1.9878e-03,  2.0029e-08,  2.4971e-08, -1.2000e-08,  4.8476e-09,
1.0388e-08, -1.1004e-08]

[ 8.1452e-03,  2.2272e-02, -3.9219e-01, -9.3283e-01, -3.5394e-01,
5.6411e-01, -5.3906e-01,  5.1813e-01, -7.6265e-02,  1.2759e-02,
6.2192e-04,  6.4306e-04,  2.0697e+00, -1.4335e-08, -2.1800e-08,
1.9007e+00, -1.6714e-08,  4.8570e-09,  1.1368e-02,  2.7440e-03,
-1.3559e-03,  3.7835e-02,  2.0287e-03,  1.3677e-03,  1.0441e-02,
-4.6874e-04,  1.2826e-02,  1.3410e-04,  1.3062e-03,  2.0130e-04,
-8.5598e-09, -5.1349e-09,  1.0692e-08,  4.3680e-09,  2.5268e-09,
5.8875e-09, -1.9739e-03,  8.4728e-04, -7.5228e-04,  2.4586e-01,
1.6178e-02, -1.6784e-01,  1.7352e-01,  1.2561e-01,  3.8980e-01,
6.8345e-04,  2.8657e-05,  8.5884e-05,  4.2266e-01,  2.1512e-01,
-4.0529e-01,  4.3593e-01,  6.2979e-02,  7.4549e-01,  9.4438e-09,
-1.6784e+00,  4.3860e-09, -6.0148e-09,  7.4477e-02, -3.0952e-09,
1.3070e-04, -9.5241e-03, -1.4197e-03, -1.0063e-03, -9.1833e-04,
1.6120e-03, -5.3456e-09,  8.1927e-09,  1.2834e-08,  8.2886e-09,
3.8633e-09,  6.4518e-09]

[ 4.0700e-02, -1.6903e-03, -2.1482e-01, -4.3373e-01, -4.8235e-01,
1.6535e-02, -6.7143e-01, -1.9247e-01, -2.2053e-01,  5.9762e-02,
1.2413e-02,  1.8819e-03,  8.2157e-01, -1.4337e-08, -4.0503e-09,
1.2643e+00, -5.9585e-09,  9.5899e-09,  4.2386e-02, -1.7430e-03,
1.4061e-03,  2.4358e-02, -7.9599e-03,  6.1409e-04,  3.5730e-02,
-1.5212e-02,  7.8025e-03, -7.1254e-02,  2.2289e-03, -1.2510e-02,
-2.4807e-09, -9.4112e-10, -5.7259e-09, -6.8139e-09,  8.8556e-09,
4.3521e-09, -2.3184e-02,  5.4955e-03,  5.0817e-02, -2.9287e-01,
5.6208e-02,  3.2453e-01, -3.4093e-01,  1.2559e-01, -2.0122e-01,
3.6758e-02,  5.6499e-04, -4.4764e-02, -3.3446e-01,  2.9671e-01,
6.2768e-01, -8.7009e-01, -5.1333e-02, -1.1011e-01, -4.4426e-09,
-7.6046e-01, -2.0117e-09,  6.6852e-09,  1.2123e-01,  2.9214e-09,
1.1201e-02, -5.7707e-02,  3.7609e-02, -9.0523e-02,  1.0974e-01,
-1.5141e-01,  4.6671e-09,  1.1483e-08,  2.5949e-09,  6.0768e-09,
-1.0553e-08, -3.2601e-09]

[ 6.3773e-02, -1.4752e-02,  2.4068e-01, -1.8110e-01, -3.5430e-01,
3.6510e-01, -2.4506e-01, -1.6941e-01,  3.2852e-02,  1.2727e-02,
-1.1913e-02, -1.5202e-02,  6.7008e-01,  2.0502e-09,  7.7180e-09,
3.2101e-01,  1.4855e-09,  1.4775e-08,  1.5463e-02, -1.9484e-02,
1.5992e-02,  4.5683e-01, -3.2215e-01, -2.6929e-02,  1.0007e-02,
-7.9374e-03,  3.5971e-03, -1.7555e-02, -7.0671e-03, -1.6829e-03,
4.1995e-09, -6.3127e-09, -6.3445e-09, -1.4698e-09, -4.2630e-10,
-8.6068e-10, -1.9575e-02, -6.6019e-03,  3.4712e-02,  3.8299e-01,
-2.8473e-02, -1.9987e-01, -1.7074e-01, -2.0551e-01,  4.8975e-02,
4.7106e-03,  4.8970e-03, -2.6870e-02,  1.4773e-02,  3.6746e-01,
-4.3651e-01, -4.7408e-01, -3.6874e-01,  1.5897e-01,  5.2200e-09,
-6.6585e-01, -7.3682e-09, -1.0455e-08,  4.1676e-01,  6.8631e-09,
6.3825e-03,  1.7375e-02,  3.0700e-03,  1.7919e-01,  1.0603e-01,
-2.7861e-02, -5.3487e-09, -1.4314e-08, -1.5890e-08, -6.9468e-09,
2.2770e-09, -1.1878e-08]
"""

def extract_and_save(text, output_dir="static_stats"):
    # 创建保存目录
    if not os.path.exists(output_dir):
        os.makedirs(output_dir)
        print(f"Created directory: {output_dir}")

    # 分割 betas 和 pose 部分
    # 假设文本结构是 betas: ... pose: ...
    parts = text.split("pose:")
    if len(parts) < 2:
        print("Error: Could not find 'pose:' separator.")
        return

    betas_text = parts[0]
    pose_text = parts[1]

    # 定义通用解析函数
    def parse_section(section_text):
        # 使用正则匹配所有 [...] 内容，re.DOTALL 让 . 匹配换行符
        matches = re.findall(r'\[(.*?)\]', section_text, re.DOTALL)
        data_list = []
        for match in matches:
            # 清理换行和逗号，统一转换为空格
            clean_str = match.replace('\n', ' ').replace(',', ' ')
            # 从字符串转换为 numpy 数组
            arr = np.fromstring(clean_str, sep=' ')
            data_list.append(arr)
        return data_list

    # 解析 betas
    betas_list = parse_section(betas_text)
    print(f"Found {len(betas_list)} betas entries.")
    
    # 保存 betas
    for idx, beta in enumerate(betas_list):
        filename = os.path.join(output_dir, f"betas_{10+idx}.npz")
        # 保存为 .npz，key 设为 'betas'
        np.savez(filename, betas=beta)
        print(f"Saved {filename} (shape: {beta.shape})")

    # 解析 pose
    pose_list = parse_section(pose_text)
    print(f"Found {len(pose_list)} pose entries.")

    # 保存 pose
    for idx, pose in enumerate(pose_list):
        filename = os.path.join(output_dir, f"pose_{7+idx}.npz")
        # 保存为 .npz，key 设为 'pose'
        np.savez(filename, pose=pose)
        print(f"Saved {filename} (shape: {pose.shape})")

if __name__ == "__main__":
    extract_and_save(raw_data)

    